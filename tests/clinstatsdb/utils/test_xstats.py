from clinstatsdb.utils import xstats

def test_parse():
    assert xstats.parse('tests/fixtures/rundir/') == {
        'SVE2274A10_TCTCGCGC': {'barcodes': 475692348,
                                'flowcell': 'HC7H2ALXX',
                                'lane': '7',
                                'one_mismatch_barcodes': 20694926,
                                'perfect_barcodes': 454997422,
                                'pf_Q30': 83.67,
                                'pf_clusters': 496446277,
                                'pf_qscore': 35.96,
                                'pf_read1_q30': 88.79,
                                'pf_read2_q30': 78.56,
                                'pf_yield': 149926775654,
                                'pf_yield_pc': 79.92,
                                'raw_clusters_pc': 100,
                                'sample_name': 'SVE2274A10_TCTCGCGC',
                                'undetermined_pc': 4.180498467108054,
                                'undetermined_proc': 0},
        'SVE2274A11_TCTCGCGC': {'barcodes': 487052714,
                                'flowcell': 'HC7H2ALXX',
                                'lane': '8',
                                'one_mismatch_barcodes': 208158124,
                                'perfect_barcodes': 278894590,
                                'pf_Q30': 87.88,
                                'pf_clusters': 509529736,
                                'pf_qscore': 37.15,
                                'pf_read1_q30': 91.63,
                                'pf_read2_q30': 84.13,
                                'pf_yield': 153877980272,
                                'pf_yield_pc': 82.02,
                                'raw_clusters_pc': 100,
                                'sample_name': 'SVE2274A11_TCTCGCGC',
                                'undetermined_pc': 4.4113268396174625,
                                'undetermined_proc': 0},
         'SVE2274A2_TCCGCGAA': {'barcodes': 481129304,
                                'flowcell': 'HC7H2ALXX',
                                'lane': '1',
                                'one_mismatch_barcodes': 20574865,
                                'perfect_barcodes': 460554439,
                                'pf_Q30': 87.58,
                                'pf_clusters': 500161560,
                                'pf_qscore': 37.05,
                                'pf_read1_q30': 91.8,
                                'pf_read2_q30': 83.36,
                                'pf_yield': 151048791120,
                                'pf_yield_pc': 80.51,
                                'raw_clusters_pc': 100,
                                'sample_name': 'SVE2274A2_TCCGCGAA',
                                'undetermined_pc': 3.805221656778262,
                                'undetermined_proc': 0},
         'SVE2274A4_TCCGCGAA': {'barcodes': 461509460,
                                'flowcell': 'HC7H2ALXX',
                                'lane': '2',
                                'one_mismatch_barcodes': 50449617,
                                'perfect_barcodes': 411059843,
                                'pf_Q30': 86.71,
                                'pf_clusters': 504919125,
                                'pf_qscore': 36.82,
                                'pf_read1_q30': 91.57,
                                'pf_read2_q30': 81.84,
                                'pf_yield': 152485575750,
                                'pf_yield_pc': 81.28,
                                'raw_clusters_pc': 100,
                                'sample_name': 'SVE2274A4_TCCGCGAA',
                                'undetermined_pc': 8.597350120180138,
                                'undetermined_proc': 0},
         'SVE2274A6_TCCGCGAA': {'barcodes': 475599205,
                                'flowcell': 'HC7H2ALXX',
                                'lane': '3',
                                'one_mismatch_barcodes': 25894701,
                                'perfect_barcodes': 449704504,
                                'pf_Q30': 87.38,
                                'pf_clusters': 496182972,
                                'pf_qscore': 36.98,
                                'pf_read1_q30': 91.2,
                                'pf_read2_q30': 83.57,
                                'pf_yield': 149847257544,
                                'pf_yield_pc': 79.87,
                                'raw_clusters_pc': 100,
                                'sample_name': 'SVE2274A6_TCCGCGAA',
                                'undetermined_pc': 4.148422691135802,
                                'undetermined_proc': 0},
         'SVE2274A7_TCCGCGAA': {'barcodes': 473147079,
                                'flowcell': 'HC7H2ALXX',
                                'lane': '4',
                                'one_mismatch_barcodes': 209429007,
                                'perfect_barcodes': 263718072,
                                'pf_Q30': 87.12,
                                'pf_clusters': 500501443,
                                'pf_qscore': 36.91,
                                'pf_read1_q30': 90.53,
                                'pf_read2_q30': 83.72,
                                'pf_yield': 151151435786,
                                'pf_yield_pc': 80.57,
                                'raw_clusters_pc': 100,
                                'sample_name': 'SVE2274A7_TCCGCGAA',
                                'undetermined_pc': 5.465391635244496,
                                'undetermined_proc': 0},
         'SVE2274A8_TCCGCGAA': {'barcodes': 489960378,
                                'flowcell': 'HC7H2ALXX',
                                'lane': '5',
                                'one_mismatch_barcodes': 22970952,
                                'perfect_barcodes': 466989426,
                                'pf_Q30': 88.84,
                                'pf_clusters': 510310624,
                                'pf_qscore': 37.4,
                                'pf_read1_q30': 92.27,
                                'pf_read2_q30': 85.42,
                                'pf_yield': 154113808448,
                                'pf_yield_pc': 82.15,
                                'raw_clusters_pc': 100,
                                'sample_name': 'SVE2274A8_TCCGCGAA',
                                'undetermined_pc': 3.987815468250961,
                                'undetermined_proc': 0},
         'SVE2274A9_TCTCGCGC': {'barcodes': 480369230,
                                'flowcell': 'HC7H2ALXX',
                                'lane': '6',
                                'one_mismatch_barcodes': 217616245,
                                'perfect_barcodes': 262752985,
                                'pf_Q30': 87.03,
                                'pf_clusters': 503887902,
                                'pf_qscore': 36.91,
                                'pf_read1_q30': 91.29,
                                'pf_read2_q30': 82.78,
                                'pf_yield': 152174146404,
                                'pf_yield_pc': 81.11,
                                'raw_clusters_pc': 100,
                                'sample_name': 'SVE2274A9_TCTCGCGC',
                                'undetermined_pc': 4.667441291337056,
                                'undetermined_proc': 0}}


def test_parse_samples():
    assert xstats.parse_samples('tests/fixtures/rundir/') == {
            '1': {'SVE2274A2_TCCGCGAA': {'barcodes': 481129304,
                              'flowcell': 'HC7H2ALXX',
                              'lane': '1',
                              'one_mismatch_barcodes': 20574865,
                              'perfect_barcodes': 460554439,
                              'pf_Q30': 87.93,
                              'pf_clusters': 481129304,
                              'pf_qscore': 37.14,
                              'pf_read1_q30': 92.11,
                              'pf_read2_q30': 83.75,
                              'pf_yield': 145301049808,
                              'pf_yield_pc': 100.0,
                              'raw_clusters_pc': 100.0,
                              'sample_name': 'SVE2274A2_TCCGCGAA',
                              'undetermined_pc': 0.0,
                              'undetermined_proc': 0}},
 '2': {'SVE2274A4_TCCGCGAA': {'barcodes': 461509460,
                              'flowcell': 'HC7H2ALXX',
                              'lane': '2',
                              'one_mismatch_barcodes': 50449617,
                              'perfect_barcodes': 411059843,
                              'pf_Q30': 87.32,
                              'pf_clusters': 461509460,
                              'pf_qscore': 36.99,
                              'pf_read1_q30': 92.0,
                              'pf_read2_q30': 82.65,
                              'pf_yield': 139375856920,
                              'pf_yield_pc': 100.0,
                              'raw_clusters_pc': 100.0,
                              'sample_name': 'SVE2274A4_TCCGCGAA',
                              'undetermined_pc': 0.0,
                              'undetermined_proc': 0}},
 '3': {'SVE2274A6_TCCGCGAA': {'barcodes': 475599205,
                              'flowcell': 'HC7H2ALXX',
                              'lane': '3',
                              'one_mismatch_barcodes': 25894701,
                              'perfect_barcodes': 449704504,
                              'pf_Q30': 87.71,
                              'pf_clusters': 475599205,
                              'pf_qscore': 37.07,
                              'pf_read1_q30': 91.48,
                              'pf_read2_q30': 83.94,
                              'pf_yield': 143630959910,
                              'pf_yield_pc': 100.0,
                              'raw_clusters_pc': 100.0,
                              'sample_name': 'SVE2274A6_TCCGCGAA',
                              'undetermined_pc': 0.0,
                              'undetermined_proc': 0}},
 '4': {'SVE2274A7_TCCGCGAA': {'barcodes': 473147079,
                              'flowcell': 'HC7H2ALXX',
                              'lane': '4',
                              'one_mismatch_barcodes': 209429007,
                              'perfect_barcodes': 263718072,
                              'pf_Q30': 87.57,
                              'pf_clusters': 473147079,
                              'pf_qscore': 37.03,
                              'pf_read1_q30': 90.94,
                              'pf_read2_q30': 84.21,
                              'pf_yield': 142890417858,
                              'pf_yield_pc': 100.0,
                              'raw_clusters_pc': 100.0,
                              'sample_name': 'SVE2274A7_TCCGCGAA',
                              'undetermined_pc': 0.0,
                              'undetermined_proc': 0}},
 '5': {'SVE2274A8_TCCGCGAA': {'barcodes': 489960378,
                              'flowcell': 'HC7H2ALXX',
                              'lane': '5',
                              'one_mismatch_barcodes': 22970952,
                              'perfect_barcodes': 466989426,
                              'pf_Q30': 89.26,
                              'pf_clusters': 489960378,
                              'pf_qscore': 37.52,
                              'pf_read1_q30': 92.67,
                              'pf_read2_q30': 85.85,
                              'pf_yield': 147968034156,
                              'pf_yield_pc': 100.0,
                              'raw_clusters_pc': 100.0,
                              'sample_name': 'SVE2274A8_TCCGCGAA',
                              'undetermined_pc': 0.0,
                              'undetermined_proc': 0}},
 '6': {'SVE2274A9_TCTCGCGC': {'barcodes': 480369230,
                              'flowcell': 'HC7H2ALXX',
                              'lane': '6',
                              'one_mismatch_barcodes': 217616245,
                              'perfect_barcodes': 262752985,
                              'pf_Q30': 87.43,
                              'pf_clusters': 480369230,
                              'pf_qscore': 37.02,
                              'pf_read1_q30': 91.64,
                              'pf_read2_q30': 83.21,
                              'pf_yield': 145071507460,
                              'pf_yield_pc': 100.0,
                              'raw_clusters_pc': 100.0,
                              'sample_name': 'SVE2274A9_TCTCGCGC',
                              'undetermined_pc': 0.0,
                              'undetermined_proc': 0}},
 '7': {'SVE2274A10_TCTCGCGC': {'barcodes': 475692348,
                               'flowcell': 'HC7H2ALXX',
                               'lane': '7',
                               'one_mismatch_barcodes': 20694926,
                               'perfect_barcodes': 454997422,
                               'pf_Q30': 84.0,
                               'pf_clusters': 475692348,
                               'pf_qscore': 36.05,
                               'pf_read1_q30': 89.09,
                               'pf_read2_q30': 78.92,
                               'pf_yield': 143659089096,
                               'pf_yield_pc': 100.0,
                               'raw_clusters_pc': 100.0,
                               'sample_name': 'SVE2274A10_TCTCGCGC',
                               'undetermined_pc': 0.0,
                               'undetermined_proc': 0}},
 '8': {'SVE2274A11_TCTCGCGC': {'barcodes': 487052714,
                               'flowcell': 'HC7H2ALXX',
                               'lane': '8',
                               'one_mismatch_barcodes': 208158124,
                               'perfect_barcodes': 278894590,
                               'pf_Q30': 88.32,
                               'pf_clusters': 487052714,
                               'pf_qscore': 37.27,
                               'pf_read1_q30': 92.06,
                               'pf_read2_q30': 84.58,
                               'pf_yield': 147089919628,
                               'pf_yield_pc': 100.0,
                               'raw_clusters_pc': 100.0,
                               'sample_name': 'SVE2274A11_TCTCGCGC',
                               'undetermined_pc': 0.0,
                               'undetermined_proc': 0}}}
